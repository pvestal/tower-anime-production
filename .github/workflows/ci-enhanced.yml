yaml<br>name: Anime Production CI<br><br>on:<br> push:<br> branches: [ main, develop ]<br> pull_request:<br> branches: [ main ]<br> workflow_dispatch: # Allow manual trigger<br><br>jobs:<br> unit-tests:<br> runs-on: ubuntu-latest<br> strategy:<br> matrix:<br> python-version: ['3.10', '3.11']<br> steps:<br> - uses: actions/checkout@v4<br> - name: Set up Python ${{ matrix.python-version }}<br> uses: actions/setup-python@v4<br> with:<br> python-version: ${{ matrix.python-version }}<br> - name: Install dependencies<br> run: |<br> pip install -r requirements.txt<br> pip install pytest pytest-asyncio pytest-mock<br> - name: Run unit tests<br> run: |<br> pytest tests/unit/ -v --tb=short<br><br> integration-tests:<br> runs-on: ubuntu-latest<br> needs: unit-tests<br> services:<br> postgres:<br> image: postgres:15<br> env:<br> POSTGRES_DB: tower_test<br> POSTGRES_PASSWORD: testpass<br> options: >-<br> --health-cmd pg_isready<br> --health-interval 10s<br> --health-timeout 5s<br> --health-retries 5<br> ports:<br> - 5432:5432<br> redis:<br> image: redis:7<br> options: >-<br> --health-cmd "redis-cli ping"<br> --health-interval 10s<br> --health-timeout 5s<br> --health-retries 5<br> ports:<br> - 6379:6379<br> steps:<br> - uses: actions/checkout@v4<br> - name: Set up Python<br> uses: actions/setup-python@v4<br> with:<br> python-version: '3.11'<br> - name: Install dependencies<br> run: |<br> pip install -r requirements.txt<br> pip install pytest requests<br> - name: Initialize database<br> run: |<br> psql -h localhost -U postgres -c "CREATE DATABASE tower_test;"<br> # Add commands to run your schema scripts here<br> - name: Run integration tests<br> run: |<br> pytest tests/integration/ -v --tb=short<br>
